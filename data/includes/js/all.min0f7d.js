function r7createCookie(a,b,c,d){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3);var f="; expires="+e.toGMTString();document.cookie=a+"="+b+f+"; path=/; domain="+d+";"}function r7readCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null}function loadData(a){jQuery.getJSON(a,function(a){countryData=a,$.each(countryData.countries[0],function(a,b){var c=a,d=a.toLowerCase(),e=b[0].name,f=$("<li />").addClass("country-option").attr("data-iso",c).append("<div class='flag-box'><div class='iti-flag "+d+"'></div></div>").append("<span class='country-name'>"+e+"</span>");$(".country-list").each(function(){$(this).append(f.clone())})}),$(".selected-country").on("click",function(){$(this).next(".country-list").slideToggle()}),$(".selected-flag").on("click",function(){$(this).next(".country-list").slideToggle()}),alphabetiseList()})}function commaSeparateNumber(a){for(;/(\d+)(\d{3})/.test(a.toString());)a=a.toString().replace(/(\d+)(\d{3})/,"$1,$2");return a}function alphabetiseList(){$("ul.country-list").each(function(){var a=$(this).children("li").sort(function(a,b){var c=$("span.country-name",a).text(),d=$("span.country-name",b).text();return c<d?-1:c>d?1:0});$(this).empty(),$(this).append(a.clone()),$(this).prepend('<div class="filter alpha active">A to Z</div><div class="filter rank" onclick="rankList();">By Exposure</div>')}),$(".country-option").on("click",function(){$(this).parent(".country-list").hide(),selectCountry($(this).attr("data-iso"))})}function rankList(){$("ul.country-list").each(function(){var a=$(this).children("li").sort(function(a,b){var c=$(a).attr("data-rank"),d=$(b).attr("data-rank");return c<d?-1:c>d?1:0});$(this).empty(),$(this).append(a.clone()),$(this).prepend('<div class="filter alpha" onclick="alphabetiseList();"">A to Z</div><div class="filter rank active">By Exposure</div>')}),$(".country-option").on("click",function(){$(this).parent(".country-list").hide(),selectCountry($(this).attr("data-iso"))})}function addSuffix(a){var b=a%10,c=a%100;return 1==b&&11!=c?a+"<sup>st</sup>":2==b&&12!=c?a+"<sup>nd</sup>":3==b&&13!=c?a+"<sup>rd</sup>":a+"<sup>th</sup>"}function showGate(){$(".modal-overlay").fadeIn(),$("#formModal").fadeIn()}function showAnchorModal(){var a=window.location.hash.substr(1,3).toString();2===a.length&&selectCountry(a)}function selectCountry(a){if(console.log("country: "+a),window.location.hash="#"+a,activeCountry=a,countryData.countries[0][a]){var b=countryData.countries[0][a][0],c=b.services[0],d=b.ports,e=$("#"+a).attr("data-rank"),f=$("#"+a).attr("fill"),g=$("#panelModal"),h="#panelModal";$("#servicesDropdown").val("web"),g.find(".country-list").hide(),$(h+" .panel-header").css({"border-top-color":f}),$(h+" h2").html(b.name+"<br /><span>"+addSuffix(e)+" most exposed of "+countryCount+" countries</span>"),$(h+" .selected-flag").empty().append('<div class="iti-flag '+a+'"></div>'),$(h+" .marker").empty().append('<div class="iti-flag '+a+'"></div>'),$(h+" #unencryptedPercent").text((100*c.unencryptedPercent).toFixed(2)+"%"),$(h+" #totalNodes").text(commaSeparateNumber(c.totalNodes));var j=(c.srank/countryCount*100).toFixed(2)+"%";for($(h+" #servicesGraph .marker").css({left:j}),$(h+" #portExplorer").empty(),$(h+" #portDetails").empty(),$(h+" #totalDevices").text(commaSeparateNumber(b.totalDevices)),i=0;i<portCount;i++){var k=i+1;$port=$("<div>"+k+"</div>"),$port.attr("data-id",k),$(h+" #portExplorer").append($port)}if($.each(d,function(a,b){var c=$("#portExplorer").children("div[data-id='"+b.port+"']");if(c.attr("data-qty",b.openQuantity),c.attr("data-pct",b.openPercent),b.openPercent<.5)var d="rgba(37,150,205,"+(1-2*b.openPercent)+")";else var d="rgba(233,95,38,"+2*(b.openPercent-.5)+")";c.css({"background-color":d}),b.openPercent>.4&&b.openPercent<.6&&c.css({color:"#bbb"}),0==a&&c.addClass("active")}),$(h+" #portDetails").html("% of Devices with 1 port open: "+(100*d[0].openPercent).toFixed(2)+"%<br /># of Devices with 1 port open: "+commaSeparateNumber(d[0].openQuantity)),e==countryCount)var l=$(".country[data-rank='"+(parseInt(e,10)-2)+"']");else var l=$(".country[data-rank='"+(parseInt(e,10)+1)+"']");if($(h+" #nextRank .button").text(countryData.countries[0][l.attr("id")][0].name),$(h+" #nextRank").attr("onclick","selectCountry('"+l.attr("id")+"')"),1==e)var m=$(".country[data-rank='"+(parseInt(e,10)+2)+"']");else var m=$(".country[data-rank='"+(parseInt(e,10)-1)+"']");$(h+" #prevRank .button").text(countryData.countries[0][m.attr("id")][0].name),$(h+" #prevRank").attr("onclick","selectCountry('"+m.attr("id")+"')"),$("#servicesDropdown").change(function(){var a=$(this).val();switch(a){case"web":var b=countryData.countries[0][activeCountry][0].services[0];break;case"smtp":var b=countryData.countries[0][activeCountry][0].services[1];break;case"pop":var b=countryData.countries[0][activeCountry][0].services[2];break;case"imap":var b=countryData.countries[0][activeCountry][0].services[3];break;case"shell":var b=countryData.countries[0][activeCountry][0].services[4]}var c=(100*b.unencryptedPercent).toFixed(2);$(h+" #unencryptedPercent").text(c+"%").hide().fadeIn(400),$(h+" #totalNodes").text(commaSeparateNumber(b.totalNodes)).hide().fadeIn(400),$(h+" #servicesGraph img").hide().attr("src",imageDirectory+a+".png").fadeIn();var d=(b.srank/countryCount*100).toFixed(2)+"%";$(h+" #servicesGraph .marker").animate({left:d})}),$(".reveal.panel").is(":visible")||(g.foundation("open"),$(".reveal.panel").removeClass("hidden"),$(".reveal.panel div").delay(700).fadeIn())}$("#portExplorer div[data-qty]").on("mouseover",function(){$("#portExplorer div").removeClass("active"),$(this).addClass("active");var a=$(this).attr("data-id"),b=commaSeparateNumber($(this).attr("data-qty")),c=(100*$(this).attr("data-pct")).toFixed(2);1===a?$(h+" #portDetails").html("% of Devices with 1 port open: "+c+"%<br /># of Devices with 1 port open: "+b):$(h+" #portDetails").html("% of Devices with "+a+" ports open: "+c+"%<br /># of Devices with "+a+" ports open: "+b)})}function loadMap(a){function b(){d3.select("#map").select("svg").select("g").attr("transform","translate("+d3.event.transform.x+","+d3.event.transform.y+") scale("+d3.event.transform.k+")")}function c(a,b){if(a)throw a;e.append("g").attr("class","world").selectAll("path").data(topojson.feature(b,b.objects.countries).features).enter().append("path").attr("class","country").attr("fill",function(a){return i(a.rank=f.get(a.id))}).attr("id",function(a){return a.id}).attr("data-rank",function(a){return a.rank}).attr("d",h).on("click",function(a){selectCountry(a.id)}).on("mouseover",function(a){showToolTip(a.id,d3.event.pageX,d3.event.pageY)}).on("mouseout",function(a){hideToolTip()}).call(addRanks).call(fadeInMap).call(showAnchorModal)}var d=d3.zoom().scaleExtent([1,7]).on("zoom",b);d3.select("#zoom-in").on("click",function(){d.scaleBy(e,1.5)}),d3.select("#zoom-out").on("click",function(){d.scaleBy(e,.5)});var e=d3.select("#map").append("div").classed("svg-container",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","-5 0 969 426").classed("svg-content-responsive",!0).call(d),f=(d3.selectAll("country"),d3.map());e.on("click",function(){j.style("display","none")});var g=d3.geoEquirectangular(),h=d3.geoPath(g),i=d3.scaleQuantize().domain([0,countryCount]).range(["#e95f26","#ee865b","#f4af92","#f8c8b5","#fbdfd4","#fdefe9","#ffffff","#e9f4fa","#d3eaf5","#b2daed","#92cae6","#58aed9","#2596cd"]),j=d3.selectAll(".country-list");d3.queue().defer(d3.json,"../includes/data/countries.json").defer(d3.tsv,a,function(a){f.set(a.id,+a.rank)}).await(c)}function showToolTip(a,b,c){var d=$("#"+a).attr("data-rank");if(countryData.countries[0][a])var e="<span>"+countryData.countries[0][a][0].name+"</span><br />"+addSuffix(d)+" most exposed";else var e="No data available";var f=$("#tooltip");f.css({left:b}).css({top:c}).html(e).show()}function hideToolTip(){$("#tooltip").hide()}function addRanks(){$(".country-option").each(function(){var a=$(this).attr("data-iso"),b=$(".country[id='"+a+"']").attr("data-rank"),c=("00"+b).slice(-3);$(this).append('<span class="country-rank">'+addSuffix(b)+"</span>"),$(this).attr("data-rank",c)})}function fadeInMap(){$("#map").animate({opacity:1},500)}$(document).ready(function(){$(document).foundation()});var $r7gdprBannerElem=$("#gdprBanner"),$r7gdprBannerCloseElem=$("#gdprBanner #gdprClose"),thisDomain=".rapid7.com";null===r7readCookie("r7gdprAnalytics")&&$r7gdprBannerElem.show(),$r7gdprBannerCloseElem.click(function(){$r7gdprBannerElem.hide(),r7createCookie("r7gdprAnalytics","acknowledged",120,thisDomain)});var activeCountry,countryData,countryCount,portCount,imgDirectory;$("#nei-2017").length>0?(countryCount=183,portCount=31,imageDirectory="../includes/img/nei-2017/",loadData("../includes/data/nei_2017.json"),loadMap("../includes/data/country-rank_2017.tsv")):(countryCount=187,portCount=37,imageDirectory="../includes/img/nei-2018/",loadData("../includes/data/nei_2018.json"),loadMap("../includes/data/country-rank_2018.tsv")),$(document).mouseup(function(a){var b=$(".country-list-container");b.is(a.target)||0!==b.has(a.target).length||$(".country-list").hide()}),$("#infoIcon").on("click",function(){$(this).parent("div").hasClass("tiny")&&$(this).parent("div").removeClass("tiny")}),$(".info-box").on("click",".close-button",function(){$(this).parent("div").addClass("tiny")}),$(".panel-header .close-button").on("click",function(){window.location.hash="",$(".reveal.panel div").hide()}),$("#formModal .close-button").on("click",function(){$(".modal-overlay").fadeOut(),$(this).parents("#formModal").fadeOut()});